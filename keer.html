<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<title>Keersommen</title>

<style>
body{
  font-family:system-ui,sans-serif;
  background:#f4f6ff;
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center
}
.box{
  background:#fff;
  padding:2rem 2.4rem;
  border-radius:1.5rem;
  box-shadow:0 10px 30px rgba(0,0,0,.1);
  max-width:760px;
  width:95%;
  text-align:center
}
.top{
  display:flex;
  justify-content:space-between;
  margin-bottom:1rem;
}
a{
  text-decoration:none;
  font-weight:800;
  color:#4f46e5
}
.pill{
  background:#eef2ff;
  padding:.35rem .7rem;
  border-radius:999px;
  font-weight:900
}
.q{
  font-size:3rem;
  margin:1.2rem 0;
}
input{
  font-size:1.6rem;
  padding:.5rem .9rem;
  width:240px;
  text-align:center;
  border-radius:.9rem;
  border:2px solid #ccc;
}
button{
  margin-top:1rem;
  padding:.8rem 1.3rem;
  border:none;
  border-radius:999px;
  background:#4f46e5;
  color:white;
  font-weight:900;
  cursor:pointer
}
.feedback{
  height:1.4rem;
  font-weight:900;
}
.good{color:#16a34a}
.bad{color:#dc2626}
</style>
</head>

<body>
<div class="box">

<div class="top">
  <a href="menu.html">‚Üê Menu</a>
  <div class="pill" id="who"></div>
</div>

<h1>Keersommen</h1>
<div class="pill" id="level"></div>

<p>
‚è± <span id="time">2:00</span> |
‚úÖ <span id="good">0</span> |
üìä <span id="tries">0</span>
</p>

<div class="q" id="question">Klik op start</div>
<input id="answer" type="number" disabled>
<div class="feedback" id="feedback"></div>

<button id="start">Start</button>

</div>

<script>
// ===== leerling =====
const CURRENT = "rekenen_current_student_v1";
const DATA = "rekenen_data_v1_";
const id = localStorage.getItem(CURRENT);
if(!id) location.href="index.html";
document.getElementById("who").textContent = id;

function key(){ return DATA+id }
function getData(){
  return JSON.parse(localStorage.getItem(key())) || {levels:{keer:0}}
}
function saveData(d){ localStorage.setItem(key(),JSON.stringify(d)) }

// ===== levels =====
const LEVELS = [
  "Tafel van 2",
  "Tafel van 2 en 10",
  "Tafel van 2, 5 en 10",
  "Tafel van 3 en 4",
  "Tafel van 2,3,4,5 en 10",
  "Tafel van 6 en 7",
  "Tafel van 2,3,4,5,6,7 en 10",
  "Tafel van 8 en 9",
  "Alle tafels",
  "Stipsommen (8 √ó ... = 56)",
  "Grote keersommen (80√ó9, 800√ó9, 80√ó90)"
];

// ===== helpers =====
function r(min,max){ return Math.floor(Math.random()*(max-min+1))+min }
function pick(arr){ return arr[r(0,arr.length-1)] }

// ===== UI =====
const qEl = document.getElementById("question");
const aEl = document.getElementById("answer");
const fEl = document.getElementById("feedback");
const tEl = document.getElementById("time");
const gEl = document.getElementById("good");
const trEl = document.getElementById("tries");
const lvlEl = document.getElementById("level");

let time=120, timer, good=0, tries=0, correct=0;

// ===== vraag =====
function makeQuestion(level){

// niveau 10: stipsom
if(level===9){
  const a = pick([2,3,4,5,6,7,8,9,10]);
  const b = r(0,10);
  correct=b;
  qEl.innerHTML=`${a} √ó ... = ${a*b}`;
  return;
}

// niveau 11: grote keersommen
if(level===10){
  const type = pick(["tiental","honderdtal","tientalxtiental"]);

  if(type==="tiental"){
    const a=pick([10,20,30,40,50,60,70,80,90]);
    const b=r(2,9);
    correct=a*b;
    qEl.textContent=`${a} √ó ${b}`;
    return;
  }

  if(type==="honderdtal"){
    const a=pick([100,200,300,400,500,600,700,800,900]);
    const b=r(2,9);
    correct=a*b;
    qEl.textContent=`${a} √ó ${b}`;
    return;
  }

  if(type==="tientalxtiental"){
    const a=pick([10,20,30,40,50,60,70,80,90]);
    const b=pick([10,20,30,40,50,60,70,80,90]);
    correct=a*b;
    qEl.textContent=`${a} √ó ${b}`;
    return;
  }
}

// normale tafels
let tables=[];
if(level===0) tables=[2];
if(level===1) tables=[2,10];
if(level===2) tables=[2,5,10];
if(level===3) tables=[3,4];
if(level===4) tables=[2,3,4,5,10];
if(level===5) tables=[6,7];
if(level===6) tables=[2,3,4,5,6,7,10];
if(level===7) tables=[8,9];
if(level===8) tables=[2,3,4,5,6,7,8,9,10];

const a=pick(tables);
const b=r(0,10);
correct=a*b;
qEl.textContent=`${a} √ó ${b}`;
}

// ===== start =====
document.getElementById("start").onclick=()=>{
  const d=getData();
  let lvl=d.levels.keer||0;
  lvlEl.textContent=`Niveau: ${LEVELS[lvl]}`;
  good=0; tries=0; time=120;
  gEl.textContent=0; trEl.textContent=0;
  aEl.disabled=false;
  aEl.value="";
  aEl.focus();
  makeQuestion(lvl);
  timer=setInterval(()=>{
    time--;
    tEl.textContent=`${Math.floor(time/60)}:${String(time%60).padStart(2,"0")}`;
    if(time<=0){
      clearInterval(timer);
      if(good>=24 && lvl<LEVELS.length-1){
        d.levels.keer=lvl+1;
        saveData(d);
        alert("üéâ Niveau omhoog!");
      }
    }
  },1000);
};

// ===== antwoord =====
aEl.onkeydown=e=>{
  if(e.key!=="Enter") return;
  tries++; trEl.textContent=tries;
  if(Number(aEl.value)===correct){
    good++; gEl.textContent=good;
    fEl.textContent="Goed!";
    fEl.className="feedback good";
  }else{
    fEl.textContent=`Fout (antwoord: ${correct})`;
    fEl.className="feedback bad";
  }
  aEl.value="";
  makeQuestion(getData().levels.keer||0);
};
</script>
</body>
</html>
